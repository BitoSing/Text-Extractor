<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Re-designed: AI Text Extractor & Transcriber</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Import Inter for English, Noto Sans Khmer for Khmer */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Noto+Sans+Khmer:wght@400;700&display=swap');
        body { background-color: #f8fafc; /* slate-50 */ }
        .font-inter { font-family: 'Inter', sans-serif; }
        .font-khmer { font-family: 'Noto Sans Khmer', 'Leelawadee UI', 'Khmer OS', 'Khmer UI', 'Inter', sans-serif; }
        
        /* Language dropdown styles (no changes needed, they are good) */
        .language-selector { position: relative; display: inline-block; }
        .language-btn { background-color: #f3f4f6; color: #4b5563; border: 1.5px solid #e5e7eb; border-radius: 24px; padding: 8px 18px 8px 12px; font-size: 15px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 10px; transition: all 0.2s; box-shadow: 0 2px 10px rgba(0,0,0,0.06); }
        .language-btn:hover, .language-btn:focus { background-color: #e0e7ff; color: #3730a3; outline: none; }
        .language-btn .arrow { margin-left: 6px; transition: transform 0.2s; }
        .language-selector.open .language-btn .arrow { transform: rotate(180deg); }
        .dropdown-content { display: none; position: absolute; right: 0; background-color: #fff; min-width: 170px; border-radius: 14px; box-shadow: 0 4px 16px rgba(0,0,0,0.13); z-index: 10; margin-top: 8px; overflow: hidden; animation: fadeIn 0.18s ease; }
        .language-selector.open .dropdown-content { display: block; }
        .language-option { color: #374151; padding: 12px 18px 12px 16px; display: flex; align-items: center; gap: 10px; font-size: 15px; background: none; border: none; width: 100%; text-align: left; cursor: pointer; transition: background 0.18s; }
        .language-option:hover, .language-option.active-language { background-color: #f1f5f9; }
        .language-flag { width: 20px; height: 20px; border-radius: 50%; object-fit: cover; box-shadow: 0 1px 4px rgba(0,0,0,0.07); }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px);} to { opacity: 1; transform: translateY(0);} }
    </style>
</head>
<body>
    <div id="root"></div>

    <!-- React and Babel Libraries -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- PDF.js library for PDF previews -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js`;
    </script>

    <script type="text/babel">
        const App = () => {
            // --- STATE MANAGEMENT ---
            const [mode, setMode] = React.useState('file');
            const [selectedFile, setSelectedFile] = React.useState(null);
            const [filePreview, setFilePreview] = React.useState(null);
            const [fileType, setFileType] = React.useState('');
            const [isRecording, setIsRecording] = React.useState(false);
            const [audioFile, setAudioFile] = React.useState(null);
            const [audioPreviewUrl, setAudioPreviewUrl] = React.useState('');
            const [recordSeconds, setRecordSeconds] = React.useState(0);
            const [extractedText, setExtractedText] = React.useState('');
            const [isLoading, setIsLoading] = React.useState(false);
            const [error, setError] = React.useState('');
            const [isDragging, setIsDragging] = React.useState(false); // New: For drag-and-drop UI
            const [isCopied, setIsCopied] = React.useState(false); // New: For copy button feedback

            // --- REFS ---
            const fileInputRef = React.useRef(null);
            const pdfCanvasRef = React.useRef(null);
            const audioInputRef = React.useRef(null);
            const mediaRecorderRef = React.useRef(null);
            const audioChunksRef = React.useRef([]);
            const recordIntervalRef = React.useRef(null);

            // --- LANGUAGE & TRANSLATION ---
            const languages = [
                { code: 'en', label: 'English', flag: 'https://flagcdn.com/us.svg', fontClass: 'font-inter' },
                { code: 'km', label: 'ភាសាខ្មែរ', flag: 'https://flagcdn.com/kh.svg', fontClass: 'font-khmer' }
            ];
            const [lang, setLang] = React.useState('en');
            const [langDropdown, setLangDropdown] = React.useState(false);
            const t = (key) => {
                const dict = { /* ... dictionary from original code ... */
                    'title': { en: 'AI Extractor & Transcriber', km: 'កម្មវិធីស្រង់ និងបម្លែងសំឡេងដោយ AI' },
                    'subtitle': { en: 'Upload a file or record audio to get a text version powered by AI.', km: 'ផ្ទុកឯកសារ ឬថតសំឡេងដើម្បីទទួលបានអត្ថបទដែលដំណើរការដោយ AI។' },
                    'file_tab': { en: 'File Extractor', km: 'ស្រង់ពីឯកសារ' },
                    'audio_tab': { en: 'Audio Transcriber', km: 'បម្លែងសំឡេង' },
                    'upload_hint': { en: 'Drag & Drop or Click to Upload', km: 'អូសនិងទម្លាក់ ឬចុចដើម្បីផ្ទុកឯកសារ' },
                    'pdf_img_limit': { en: 'PDF (max 10MB), Image (max 4MB)', km: 'PDF (អតិបរមា 10MB), រូបភាព (អតិបរមា 4MB)' },
                    'extract_btn': { en: 'Extract Text from File', km: 'ស្រង់អត្ថបទពីឯកសារ' },
                    'extracting': { en: 'Extracting...', km: 'កំពុងស្រង់...' },
                    'recording': { en: 'Recording...', km: 'កំពុងថតសំឡេង...' },
                    'or': { en: 'Or', km: 'ឬ' },
                    'record_audio': { en: 'Record Audio', km: 'ថតសំឡេង' },
                    'stop_recording': { en: 'Stop Recording', km: 'បញ្ឈប់ការថត' },
                    'upload_audio': { en: 'Upload an Audio File', km: 'ផ្ទុកឯកសារសំឡេង' },
                    'audio_limit': { en: 'Max 10MB', km: 'អតិបរមា 10MB' },
                    'audio_preview_title': { en: 'Audio Ready', km: 'សំឡេងរួចរាល់' },
                    'transcribe_btn': { en: 'Transcribe Audio', km: 'បម្លែងសំឡេងជាអត្ថបទ' },
                    'transcribing': { en: 'Transcribing...', km: 'កំពុងបម្លែង...' },
                    'results': { en: 'Results', km: 'លទ្ធផល' },
                    'copy': { en: 'Copy', km: 'ចម្លង' },
                    'copied': { en: 'Copied!', km: 'បានចម្លង!' },
                    'results_placeholder': { en: 'Your results will appear here...', km: 'លទ្ធផលរបស់អ្នកនឹងបង្ហាញនៅទីនេះ...' },
                    'error': { en: 'Error:', km: 'បញ្ហា៖' }
                };
                return dict[key]?.[lang] || dict[key]?.en || key;
            };
            const getFontClass = () => lang === 'km' ? 'font-khmer' : 'font-inter';

            // --- CORE LOGIC ---
            const toBase64 = (file) => new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result.split(',')[1]);
                reader.onerror = (error) => reject(error);
            });

            const clearState = (clearMode = true) => {
                setSelectedFile(null); setFilePreview(null); setFileType('');
                if (fileInputRef.current) fileInputRef.current.value = '';
                setIsRecording(false); setAudioFile(null); setAudioPreviewUrl('');
                if (audioInputRef.current) audioInputRef.current.value = '';
                setExtractedText(''); setError(''); setIsCopied(false);
                if (clearMode) setIsLoading(false);
            };

            const switchMode = (newMode) => {
                clearState();
                setMode(newMode);
            };

            // --- File Handling Logic (with Drag & Drop) ---
            const handleFileSelect = (file) => {
                if (!file) return;
                clearState(false);
                if (file.type.startsWith('image/') && file.size > 4 * 1024 * 1024) return setError('Image file must be under 4MB.');
                if (file.type === 'application/pdf' && file.size > 10 * 1024 * 1024) return setError('PDF file must be under 10MB.');

                if (file.type.startsWith('image/')) {
                    setFileType('image');
                    setSelectedFile(file);
                    setFilePreview(URL.createObjectURL(file));
                } else if (file.type === 'application/pdf') {
                    setFileType('pdf');
                    setSelectedFile(file);
                    renderPdfPreview(file);
                } else {
                    setError('Please select a valid image or PDF file.');
                }
            };
            
            const handleDragEvents = (e, isEntering) => {
                e.preventDefault();
                e.stopPropagation();
                setIsDragging(isEntering);
            };
            
            const handleDrop = (e) => {
                handleDragEvents(e, false);
                const file = e.dataTransfer.files?.[0];
                if (file) handleFileSelect(file);
            };

            const renderPdfPreview = async (file) => { /* ... unchanged ... */
                try {
                    const uri = URL.createObjectURL(file);
                    const pdf = await pdfjsLib.getDocument(uri).promise;
                    const page = await pdf.getPage(1);
                    const canvas = pdfCanvasRef.current;
                    const containerWidth = canvas.parentElement.offsetWidth;
                    const viewport = page.getViewport({ scale: 1 });
                    const scale = containerWidth / viewport.width;
                    const scaledViewport = page.getViewport({ scale });
                    canvas.height = scaledViewport.height;
                    canvas.width = scaledViewport.width;
                    await page.render({ canvasContext: canvas.getContext('2d'), viewport: scaledViewport }).promise;
                    URL.revokeObjectURL(uri);
                } catch (e) { setError("Could not render a preview for this PDF."); }
            };
            
            const handlePaste = (event) => { /* ... unchanged ... */
                const file = Array.from(event.clipboardData.items).find(item => item.type.startsWith('image/'))?.getAsFile();
                if(file) {
                    switchMode('file');
                    handleFileSelect(file);
                    event.preventDefault();
                }
            };
            React.useEffect(() => {
                document.addEventListener('paste', handlePaste);
                return () => document.removeEventListener('paste', handlePaste);
            }, []);

            // --- Audio Handling Logic ---
            const handleStartRecording = async () => { /* ... mostly unchanged ... */
                clearState(false);
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorderRef.current = new MediaRecorder(stream, { mimeType: 'audio/webm' });
                    audioChunksRef.current = [];
                    mediaRecorderRef.current.ondataavailable = e => audioChunksRef.current.push(e.data);
                    mediaRecorderRef.current.onstop = () => {
                        const audioBlob = new Blob(audioChunksRef.current, { type: 'audio/webm' });
                        if (audioBlob.size > 10 * 1024 * 1024) {
                            setError('Recording is too large (max 10MB). Please record a shorter clip.');
                            setAudioFile(null);
                        } else {
                            setAudioFile(audioBlob);
                            setAudioPreviewUrl(URL.createObjectURL(audioBlob));
                        }
                        stream.getTracks().forEach(track => track.stop());
                        clearInterval(recordIntervalRef.current);
                        setRecordSeconds(0);
                    };
                    mediaRecorderRef.current.start();
                    setIsRecording(true);
                    setRecordSeconds(0);
                    recordIntervalRef.current = setInterval(() => setRecordSeconds(prev => prev + 1), 1000);
                } catch (err) { setError("Microphone access denied. Please enable it in your browser settings."); }
            };
            const handleStopRecording = () => { mediaRecorderRef.current?.stop(); setIsRecording(false); };
            const handleAudioUpload = (event) => {
                const file = event.target.files[0];
                clearState(false);
                if (!file) return;
                if (file.size > 10 * 1024 * 1024) return setError('Audio file must be under 10MB.');
                if (file.type.startsWith('audio/')) {
                    setAudioFile(file);
                    setAudioPreviewUrl(URL.createObjectURL(file));
                } else { setError('Please select a valid audio file.'); }
            };

            // --- API Call & Result Handling ---
            const processApiRequest = async (prompt, file) => { /* ... unchanged ... */
                if (!file) { setError('No file or recording available to process.'); return; }
                setIsLoading(true); setExtractedText(''); setError(''); setIsCopied(false);
                const apiKey = "AIzaSyDydw9gsfTJX7nRse3A1wLNsHLV36_HfTU"; // Replace with your key
                if (apiKey.includes("PASTE_YOUR")) {
                    setError("API key is missing. Please edit the code to add your new Google Gemini API key.");
                    setIsLoading(false); return;
                }
                try {
                    const base64Data = await toBase64(file);
                    let customPrompt = prompt;
                    if (file.type.startsWith('audio/')) {
                        customPrompt = `Transcribe all spoken content from this audio file. If the language is Khmer, transcribe it accurately in Khmer Unicode script. If the language is Chinese, transcribe it accurately in Chinese characters. Otherwise, transcribe in the detected language/script. Return only the transcribed text.`.trim();
                    }
                    const payload = { contents: [{ parts: [{ text: customPrompt }, { inline_data: { mime_type: file.type, data: base64Data } }] }] };
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`;
                    const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    if (!response.ok) { const errorBody = await response.json(); throw new Error(`API request failed: ${errorBody.error.message}`); }
                    const result = await response.json();
                    if (result.candidates && result.candidates[0].content) {
                        setExtractedText(result.candidates[0].content.parts[0].text);
                    } else if (result.promptFeedback?.blockReason) {
                        setError(`Request blocked. Reason: ${result.promptFeedback.blockReason}.`);
                    } else { setError('No text could be extracted/transcribed.'); }
                } catch (err) { setError(`An error occurred: ${err.message}. Check console.`); } finally { setIsLoading(false); }
            };

            const handleCopy = () => {
                navigator.clipboard.writeText(extractedText);
                setIsCopied(true);
                setTimeout(() => setIsCopied(false), 2000);
            };

            // --- RENDER ---
            return (
                <div className={`min-h-screen flex items-center justify-center p-4 ${getFontClass()}`}>
                    <div className="bg-white rounded-2xl shadow-xl border border-slate-200 p-6 md:p-8 w-full max-w-3xl space-y-6">
                        {/* Header */}
                        <div className="flex justify-between items-center">
                            <div className="text-left">
                                <h1 className={`text-2xl md:text-3xl font-bold text-slate-800 ${getFontClass()}`}>{t('title')}</h1>
                                <p className="text-sm md:text-base text-slate-500 mt-1">{t('subtitle')}</p>
                            </div>
                            {/* Language Selector */}
                            <div className={`language-selector${langDropdown ? ' open' : ''}`} tabIndex={0} onBlur={() => setTimeout(() => setLangDropdown(false), 150)}>
                                <button className="language-btn" onClick={() => setLangDropdown(v => !v)} type="button">
                                    <img src={languages.find(l => l.code === lang).flag} className="language-flag" alt="" />
                                    <span className={languages.find(l => l.code === lang).fontClass}>{languages.find(l => l.code === lang).label}</span>
                                    <svg className="arrow" width="14" height="14" viewBox="0 0 24 24" fill="none"><path d="M6 9L12 15L18 9" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/></svg>
                                </button>
                                {langDropdown && <div className="dropdown-content">
                                    {languages.map(l => (
                                        <button key={l.code} className={`language-option${lang === l.code ? ' active-language' : ''} ${l.fontClass}`} onClick={() => { setLang(l.code); setLangDropdown(false); }} type="button">
                                            <img src={l.flag} className="language-flag" alt={l.label} /> {l.label}
                                        </button>
                                    ))}
                                </div>}
                            </div>
                        </div>

                        {/* Mode Toggler (Pill Style) */}
                        <div className="bg-slate-100 p-1 rounded-full flex w-full">
                            <button onClick={() => switchMode('file')} className={`w-1/2 p-2.5 rounded-full text-sm sm:text-base font-semibold transition-all duration-300 ${mode === 'file' ? 'bg-white shadow text-indigo-600' : 'text-slate-500 hover:text-slate-700'} ${getFontClass()}`}>{t('file_tab')}</button>
                            <button onClick={() => switchMode('audio')} className={`w-1/2 p-2.5 rounded-full text-sm sm:text-base font-semibold transition-all duration-300 ${mode === 'audio' ? 'bg-white shadow text-indigo-600' : 'text-slate-500 hover:text-slate-700'} ${getFontClass()}`}>{t('audio_tab')}</button>
                        </div>
                        
                        {/* Main Content Area */}
                        {mode === 'file' && (
                            <div className="space-y-6">
                                <div 
                                    className={`relative border-2 border-dashed rounded-xl p-6 text-center transition-colors duration-200 ${isDragging ? 'border-indigo-500 bg-indigo-50' : 'border-slate-300 hover:border-indigo-400'}`}
                                    onDragEnter={(e) => handleDragEvents(e, true)}
                                    onDragLeave={(e) => handleDragEvents(e, false)}
                                    onDragOver={(e) => handleDragEvents(e, true)}
                                    onDrop={handleDrop}
                                >
                                    <input type="file" accept="image/*,application/pdf" onChange={(e) => handleFileSelect(e.target.files[0])} className="hidden" ref={fileInputRef} />
                                    {!selectedFile ? (
                                        <div className="flex flex-col items-center justify-center h-48 cursor-pointer" onClick={() => fileInputRef.current.click()}>
                                            <svg xmlns="http://www.w3.org/2000/svg" className="h-14 w-14 text-slate-400 mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="1.5"><path strokeLinecap="round" strokeLinejoin="round" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" /></svg>
                                            <p className="font-semibold text-slate-700">{t('upload_hint')}</p>
                                            <p className="text-sm text-slate-400 mt-1">{t('pdf_img_limit')}</p>
                                        </div>
                                    ) : (
                                        <div className="relative">
                                            <button onClick={() => clearState(false)} className="absolute -top-3 -right-3 bg-slate-600 hover:bg-slate-800 text-white rounded-full h-7 w-7 flex items-center justify-center z-10" aria-label="Remove file">
                                                <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                                            </button>
                                            <div className="max-h-64 flex justify-center bg-slate-50 rounded-lg p-2">
                                                {fileType === 'image' ? <img src={filePreview} className="max-h-60 object-contain rounded-md" /> : <canvas ref={pdfCanvasRef} className="max-h-60 object-contain rounded-md"></canvas>}
                                            </div>
                                        </div>
                                    )}
                                </div>
                                <button onClick={() => processApiRequest("Extract all text from this file.", selectedFile)} disabled={!selectedFile || isLoading} className="w-full px-6 py-4 rounded-xl font-bold text-lg text-white transition-all bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-300 disabled:cursor-not-allowed flex items-center justify-center shadow-lg shadow-indigo-500/30 hover:shadow-xl hover:shadow-indigo-500/40">
                                    {isLoading ? <svg className="animate-spin mr-3 h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle><path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> : <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 mr-2" viewBox="0 0 20 20" fill="currentColor"><path d="M10 12a2 2 0 100-4 2 2 0 000 4z" /><path fillRule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clipRule="evenodd" /></svg>}
                                    {isLoading ? t('extracting') : t('extract_btn')}
                                </button>
                            </div>
                        )}

                        {mode === 'audio' && (
                           <div className="space-y-6">
                                {!audioPreviewUrl ? (
                                    <>
                                        <button onClick={isRecording ? handleStopRecording : handleStartRecording} className={`w-full px-6 py-4 rounded-xl font-bold text-lg text-white transition-all flex items-center justify-center shadow-lg ${isRecording ? 'bg-red-600 hover:bg-red-700 shadow-red-500/30 hover:shadow-red-500/40' : 'bg-indigo-600 hover:bg-indigo-700 shadow-indigo-500/30 hover:shadow-indigo-500/40'}`}>
                                            {isRecording ? (
                                                <>
                                                    <span className="animate-pulse mr-3 h-3 w-3 bg-white rounded-full"></span>
                                                    {t('stop_recording')}
                                                    <span className="ml-3 text-white/80 font-mono text-base">
                                                        {String(Math.floor(recordSeconds / 60)).padStart(2, '0')}:{String(recordSeconds % 60).padStart(2, '0')}
                                                    </span>
                                                </>
                                            ) : (
                                                <>
                                                    <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z" /></svg>
                                                    {t('record_audio')}
                                                </>
                                            )}
                                        </button>
                                        <div className="relative my-2"><div className="absolute inset-0 flex items-center"><span className="w-full border-t border-slate-200"></span></div><div className="relative flex justify-center text-sm"><span className="bg-white px-2 text-slate-400 font-medium">{t('or')}</span></div></div>
                                        <button type="button" onClick={() => audioInputRef.current?.click()} disabled={isRecording} className="w-full px-6 py-3 rounded-xl font-semibold text-slate-700 bg-slate-100 hover:bg-slate-200 disabled:bg-slate-50 disabled:text-slate-400 transition-colors flex items-center justify-center">
                                            <input type="file" accept="audio/*" onChange={handleAudioUpload} className="hidden" ref={audioInputRef} />
                                            {t('upload_audio')} <span className="ml-2 text-slate-400 text-sm font-normal">({t('audio_limit')})</span>
                                        </button>
                                    </>
                                ) : (
                                    <div className="bg-slate-50 border border-slate-200 rounded-xl p-4 space-y-4">
                                        <div className="flex justify-between items-center">
                                            <p className="font-semibold text-slate-700">{t('audio_preview_title')}</p>
                                            <button onClick={() => clearState(false)} className="bg-slate-200 hover:bg-slate-300 text-slate-600 rounded-full h-7 w-7 flex items-center justify-center" aria-label="Remove audio">
                                                <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth="2"><path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                                            </button>
                                        </div>
                                        <audio src={audioPreviewUrl} controls className="w-full"></audio>
                                    </div>
                                )}
                                <button onClick={() => processApiRequest("Transcribe the following audio.", audioFile)} disabled={!audioFile || isLoading} className="w-full px-6 py-4 rounded-xl font-bold text-lg text-white transition-all bg-indigo-600 hover:bg-indigo-700 disabled:bg-indigo-300 disabled:cursor-not-allowed flex items-center justify-center shadow-lg shadow-indigo-500/30 hover:shadow-xl hover:shadow-indigo-500/40">
                                    {isLoading ? <svg className="animate-spin mr-3 h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle><path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> : <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M9 19V6l11.59 11.59A2 2 0 0120 18.17V5a2 2 0 00-2-2H6a2 2 0 00-2 2v13.17a2 2 0 00.59 1.42L9 19z" /></svg>}
                                    {isLoading ? t('transcribing') : t('transcribe_btn')}
                                </button>
                            </div>
                        )}

                        {/* Results & Error Area */}
                        <div className="pt-6 border-t border-slate-200">
                            {error && <div className={`bg-red-100 border border-red-300 text-red-700 px-4 py-3 rounded-lg ${getFontClass()}`} role="alert"><strong className="font-bold">{t('error')} </strong><span>{error}</span></div>}
                            
                            <div className="space-y-3">
                                <div className="flex justify-between items-center">
                                    <h2 className={`text-xl font-bold text-slate-800 flex items-center ${getFontClass()}`}>
                                        <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6 mr-2 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                                        {t('results')}
                                    </h2>
                                    {extractedText && (
                                        <button onClick={handleCopy} disabled={isCopied} className="px-3 py-1.5 text-sm font-semibold text-indigo-600 bg-indigo-100 hover:bg-indigo-200 rounded-md transition-all disabled:bg-green-100 disabled:text-green-700">
                                            {isCopied ? t('copied') : t('copy')}
                                        </button>
                                    )}
                                </div>
                                <div className={`w-full bg-slate-50 p-4 rounded-lg border border-slate-200 min-h-[10rem] max-h-96 overflow-auto text-slate-700 whitespace-pre-wrap leading-relaxed ${getFontClass()}`}>
                                    {isLoading ? (
                                        <div className="flex items-center justify-center h-full text-slate-400">
                                            <svg className="animate-spin mr-3 h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle><path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path></svg>
                                            Processing...
                                        </div>
                                    ) : extractedText ? (
                                        extractedText
                                    ) : (
                                        <div className="flex items-center justify-center h-full text-slate-400">
                                            {t('results_placeholder')}
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
